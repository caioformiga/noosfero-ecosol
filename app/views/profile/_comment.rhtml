<% Comment %>
<% Profile %>
<% Person %>

<li class="article-comment" style='border-bottom:none;'>
  <div class="article-comment-inner">

  <div class="comment-content comment-logged-in">

  <% if comment.author %>
    <%= link_to image_tag(profile_icon(comment.author, :minor)),
        Person.find(comment.author_id).url,
        :class => 'comment-picture',
        :title => comment.author_name
    %>
  <% end %>

  <div class="comment-details">
    <div class="comment-text">
      <%= link_to(comment.author_name, comment.author.url) %>
      <% unless comment.title.blank? %>
        <span class="comment-title"><%= comment.title %></span><br/>
      <% end %>
      <%= txt2html comment.body %>
    </div>
    <div class="profile-activity-time">
      <%= time_ago_as_sentence(comment.created_at) %>
    </div>
  </div>

  <% if logged_in? && (user == profile || user == comment.author || user.has_permission?(:moderate_comments, profile)) %>
    <% button_bar(:style => 'float: right; margin-top: 0px;') do %>
      <%= icon_button(:delete, _('Remove'), { :action => :remove_comment, :comment_id => comment.id }, :method => :get, :confirm => _('Are you sure you want to remove this comment and all its replies?')) %>
    <% end %>
  <% end %>
  <br style="clear: both;" />

  <div class="comment_reply post_comment_box closed">
    <% if @comment && @comment.errors.any? && @comment.reply_of_id.to_i == comment.id %>
      <%= error_messages_for :comment %>
      <script type="text/javascript">
        jQuery(function() {
          document.location.href = '#<%= comment.anchor %>';
          add_comment_reply_form('#comment-reply-to-<%= comment.id %>', <%= comment.id %>);
        });
      </script>
    <% end %>
    <%= report_abuse(comment.author, :comment_link, comment) if comment.author %>
    <%= link_to_function _('Reply'),
        "var f = add_comment_reply_form(this, %s); f.find('input[name=comment[title]], textarea').val(''); return false" % comment.id,
        :class => 'comment-footer comment-footer-link comment-footer-hide',
        :id => 'comment-reply-to-' + comment.id.to_s
    %>
  </div>

  </div>

  <% unless comment.replies.blank? %>
  <ul class="comment-replies">
    <% comment.replies.each do |reply| %>
      <%= render :partial => 'comment', :locals => { :comment => reply } %>
    <% end %>
  </ul>
  <% end %>

  </div>
</li>
